<ion-header mode="md" *ngIf="status.list">
  <ion-toolbar mode="md"
    style="--background: #{{status.list.icon ? status.list.iconBackground : '363c51'}} linear-gradient(rgba(0,0,0,.2), transparent);">
    <ion-buttons slot="start">
      <ion-back-button mode="md" color="light" defaultHref="home"></ion-back-button>
    </ion-buttons>
    <ion-title>
      <ion-label color="light">{{status.title}}</ion-label>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button [routerLink]="['/notifications']" class="notification-icon-button">
        <ion-icon color="light" name="notifications"></ion-icon>
        <ion-badge *ngIf="notificationsCount !== 0" class="notification-badge" color="danger">
          <span>{{notificationsCount}}</span>
        </ion-badge>
      </ion-button>
      <ion-menu-button color="light" size="small" autoHide="false" class="toggle"></ion-menu-button>
    </ion-buttons>
  </ion-toolbar>
  <ion-toolbar mode="md">
    <div class="image-container"
      [ngStyle]="{'background-color':'#' + (status.list.icon ? status.list.iconBackground : '363c51')}">
      <img *ngIf="status.list.icon" [src]="URL_BASE + status.list.icon" />
      <img *ngIf="!status.list.icon" src="assets/notamusical.svg" />
    </div>
  </ion-toolbar>
  <ion-toolbar mode="md" *ngIf="status.activeTrack"
    style="--background: #{{(status.list.icon ? status.list.iconBackground : '363c51')}}">
    <ion-item lines="none" style="--background: #{{(status.list.icon ? status.list.iconBackground : '363c51')}}"
      class="ion-text-center">
      <ion-label color="light">
        <p>{{status.activeTrack.author}}</p>
        <h3 style="font-size: 20px;">{{status.activeTrack.fullname}}</h3>
      </ion-label>
    </ion-item>
  </ion-toolbar>
  <ion-toolbar class="menu-buttons" mode="md"
    style="--background: #{{(status.list.icon ? status.list.iconBackground : '363c51')}}">
    <ion-button [disabled]="!status.list.description" (click)="presentDescription(status.list.description)"
      class="info-list" *ngIf="!isOwn" fill="clear">
      <ion-icon slot="icon-only" color="light" name="information-circle"></ion-icon>
    </ion-button>
    <ion-button (click)="presentOwnListPopover($event, status.list)" class="info-list" *ngIf="isOwn" fill="clear">
      <ion-icon slot="icon-only" color="light" name="ellipsis-vertical"></ion-icon>
    </ion-button>
    <ion-label class="voz" position="inline" color="light">voz</ion-label>
    <ion-toggle [disabled]="!status.hasBackground || !status.activeTrack || (!status.isPremiumPlan && currentUser)" id="mic-toggle"
      color="light" (ionChange)="toggleVoice($event)" [(ngModel)]="!status.playBackground"></ion-toggle>
    <ion-button *ngIf="!status.replay" (click)="toggleReplay()" class="info-list" fill="clear">
      <ion-icon slot="icon-only" color="light" name="repeat-outline"></ion-icon>
    </ion-button>
    <ion-button *ngIf="status.replay" (click)="toggleReplay()" class="info-list" fill="clear">
      <ion-icon slot="icon-only" color="warning" name="repeat-outline"></ion-icon>
    </ion-button>
    <ion-button *ngIf="!status.random" (click)="toggleRandom()" class="info-list" fill="clear">
      <ion-icon slot="icon-only" color="light" name="shuffle-outline"></ion-icon>
    </ion-button>
    <ion-button *ngIf="status.random" (click)="toggleRandom()" class="info-list" fill="clear">
      <ion-icon slot="icon-only" color="warning" name="shuffle-outline"></ion-icon>
    </ion-button>

    <ion-button [disabled]="!status.activeTrack" slot="end" (click)="mute()" class="info-list" fill="clear">
      <ion-icon slot="icon-only" color="light" [name]="status.mute ? 'volume-mute-outline' : 'volume-high-outline'"></ion-icon>
    </ion-button>
    <ion-range [value]="status.player ? (status.player.volume() * 100) : 1" debounce="500"
      (ionChange)="changeVolume($event)" slot="end" vertical="true" debounce="500" mode="ios" color="warning">
    </ion-range>
  </ion-toolbar>
  <ion-toolbar mode="md" color="dark" class="small-toolbar">
    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <ion-label>Pistas de audio</ion-label>
        </ion-col>
        <ion-col size="6">
          <ion-searchbar (ionChange)="onSearch($event)" placeholder="Filtrar..." mode="ios"></ion-searchbar>
        </ion-col>
      </ion-row>
    </ion-grid>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-list *ngIf="status.list && status.list.songs.length > 0" class="playlist">
    <ion-item lines="full" *ngFor="let item of status.list.songs">
      <ion-button [disabled]="item.isFree && !currentUser"
        *ngIf="!status.activeTrack || (status.activeTrack && status.activeTrack._id !== item._id)" (click)="start(item)"
        class="action-button" slot="start" fill="clear">
        <ion-icon slot="icon-only" color="warning" name="play-circle-outline"></ion-icon>
      </ion-button>
      <ion-button [disabled]="item.isFree && !currentUser"
        *ngIf="status.activeTrack && status.activeTrack._id === item._id && status.isPlaying"
        (click)="togglePlayer(true)" class="action-button" slot="start" fill="clear">
        <ion-icon slot="icon-only" color="warning" name="pause-circle"></ion-icon>
      </ion-button>
      <ion-button [disabled]="item.isFree && !currentUser"
        *ngIf="status.activeTrack && status.activeTrack._id === item._id && !status.isPlaying"
        (click)="togglePlayer(false)" class="action-button" slot="start" fill="clear">
        <ion-icon slot="icon-only" color="warning" name="play-circle"></ion-icon>
      </ion-button>
      <ion-label (click)="start(item)"
        *ngIf="(!status.activeTrack || (status.activeTrack && status.activeTrack._id !== item._id)) && !(item.isFree && !currentUser)">
        <h3>{{item.fullname}}</h3>
      </ion-label>
      <ion-label style="opacity: 0.5;" *ngIf="(item.isFree && !currentUser)">
        <h3>{{item.fullname}}</h3>
      </ion-label>
      <ion-range *ngIf="status.activeTrack && status.activeTrack._id === item._id" #range [(ngModel)]="status.progress"
        max="100" min="0" mode="md" color="warning" (touchend)="seek()" (mouseup)="seek()" (touchstart)="stopUpdate()"
        (mousedown)="stopUpdate()" (ionChange)="updateProgessTime()" class="only-line">
      </ion-range>
      <ion-buttons slot="end">
        <ion-text style="opacity: 0.5;" *ngIf="(item.isFree && !currentUser)" slot="end">{{parseTime(item.duration)}}
        </ion-text>
        <ion-text *ngIf="!(item.isFree && !currentUser)" slot="end">{{parseTime(item.duration)}}</ion-text>
        <ion-button [disabled]="item.isFree && !currentUser" (click)="preloadSong(item)" size="large" slot="end" fill="clear" style="margin-right: -12px;">
          <ion-icon [color]="preloadList[item._id] ? 'primary' : 'dark'" name="download-outline"></ion-icon>
        </ion-button>
        <ion-button [disabled]="!currentUser" (click)="presentMyListPopover($event, item)" size="large"
          slot="end" fill="clear" style="margin-right: -12px;">
          <ion-icon color="dark" name="heart-outline"></ion-icon>
        </ion-button>
        <ion-button [disabled]="item.isFree && !currentUser" (click)="removeSong(item)" *ngIf="isOwn" size="large"
          slot="end" fill="clear" style="margin-right: -12px;">
          <ion-icon color="dark" name="trash-outline"></ion-icon>
        </ion-button>
        <ion-button [disabled]="item.isFree && !currentUser" size="large" slot="end" fill="clear"
          (click)="openSong(item)">
          <ion-icon color="dark" name="chevron-forward-outline"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ion-item>
  </ion-list>
</ion-content>